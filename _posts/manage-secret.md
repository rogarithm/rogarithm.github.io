#### 민감 정보 관리
2. **민감 정보를 관리하기 번거롭다**
DB 사용자 이름이나 비밀번호와 같은 민감정보를 공개된 장소에 노출하지 않기 위해 애플리케이션 실행 명령에 변수로 주입하는 방식을 이용했다. 이로 인해 애플리케이션 실행 명령이 다소 길어졌다.

{% highlight bash %}
java -jar sooldama-0.0.1-SNAPSHOT.jar --spring.profiles.active=dev \
--SERVER_MYSQL_URL="good.db.url" \
--SERVER_MYSQL_PORT="good.db.port" \
--SERVER_MYSQL_DBNAME="good_db" \
--SERVER_MYSQL_USERNAME="good_developer" \
--SERVER_MYSQL_PASSWORD="verygood!" \
--SERVER_REDIS_HOST="fast.redis.host"
{% endhighlight %}

새로 배포할 때마다 길다란 애플리케이션 실행 명령을 일일이 치기는 번거로워서 쉘 스크립트로 만들어 원격 서버 안에 두고 썼다. 공개된 장소에 민감 정보를 노출하지 않지만, 관리가 번거로웠다. 스크립트로 만들기는 했지만, 사람이 직접 입력해야 하고, 주입할 값이 바뀌면 애플리케이션을 실행할 모든 원격 서버에 일일이 접속해서 바꿔줘야 할테고 서버가 늘어나면 이런 작업이 더 생기게 되어 더 번거로워질 것이었다. 유지보수가 용이하면서도 민감 정보를 공개된 장소에 노출하지 않을 수 있는 방법을 찾아봐야 했다.

#### 민감 정보 관리 해결 방법

민감 정보 암호화는 깃허브에서 제공하는 깃헙 시크릿을 썼다.

**민감 정보를 외부에 노출하지 않을 방법 (유지 보수가 용이한)**

깃헙 액션에서 github secret 서비스를 이용해 서버 아이디나 비밀번호 같은 민감 정보를 암호화해 이들 정보를 외부에 노출하지 않도록 할 수 있다.
github secret은 github action을 정의한 yml 파일 안에서만 쓸 수 있기 때문에, 깃헙 액션 스크립트에서 잘 동작하지 않는 부분을 바깥으로 뺄 때 github secret을 써야 하는 부분은 제외하고 빼야 했다. 작동 중인 애플리케이션 프로세스를 찾고, 중지하는 과정에서 이런 조치가 필요했다.

#### 전에 생각하지 못했던 문제

1. **애플리케이션이 실행 도중 멈출 수 있다**
원격 서버에서 foreground 방식으로 애플리케이션을 실행했다. 이 경우 로컬 머신이 원격 서버와 맺은 ssh 연결이 끊어지면 애플리케이션이 더 이상 실행되지 않는다. 기존에는 새로 배포한 뒤 api 요청해서 생각한대로 동작하는지 확인할 때까지만 애플리케이션이 실행 중이면 되었어서 이 점에 대해 고려하지 않았다.
비록 토이 프로젝트지만 실제로 운영하는 서비스를 염두해두고 구현하고 있었는데, 그렇다면 사용자에게 끊김 없이 서비스를 제공해야 해야한다고 생각했다. 하지만 기존 배포 방식으로는 ssh 연결이 끊어지면 서비스가 유지되지 않고 끊어지므로 문제였다. ssh 연결이 끊어지더라도 원격 서버에서 계속해서 애플리케이션이 실행되도록  할 수 있는 방법을 찾아봐야 했다.

2. **새로 배포한 애플리케이션을 실행하면 기존에 실행 중인 애플리케이션이 멈추지 않는다**
만약 이전 버전 애플리케이션 실행 도중 새로 전송한 아티팩트로 애플리케이션을 실행한다면, 같은 서버에 서로 다른 버전의 애플리케이션이 동시에 실행될 수 있다. 그러면 애플리케이션 버전이 달라도 포트 번호는 같으므로 사용자가 요청한 api를 어느 버전 애플리케이션에서 응답할지 알 수 없고, 새로 배포할 때마다 애플리케이션이 프로세스에 생길 것이다.
따라서 만약 원격 서버에 실행 중인 애플리케이션이 있다면 중단하고 새로운 애플리케이션을 띄우는 방법을 찾아봐야 했다.

#### 전에 생각하지 못했던 문제 해결한 방법

**ssh 연결이 끊어지더라도 원격 서버에서 애플리케이션 실행 중지되지 않도록 하기**

**애플리케이션 실행 전에 이전에 실행 중이던 애플리케이션 중지하기**

서버가 이전에 실행 중인 애플리케이션이 있다면 중지하기 위해 pgrep으로 프로세스 확인 후 kill로 해당 프로세스를 멈춘다
깃헙 액션 파일 안에서 쉘 명령을 실행할 경우 원격 서버에서 실행 중인 애플리케이션 프로세스 번호를 찾지 못하는 문제가 있었다. 깃헙 액션 파일 안에서 여러 가지 시도를 해봤지만, 프로세스를 찾지 못해 이 부분을 스크립트로 추출해서 따로 실행하도록 만들었다.

